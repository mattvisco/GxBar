/**
 * Created by M on 7/31/15.
 */

// ******************************** //
// **** GOOGLE CLASS CONSTANTS **** //
// ******************************** //

// ---------- Draggables ---------- //

// Users
var USERIMAGEPOST = "Uk wi hE"; // User on a post
var USERIMAGEPOSTDOT = convertClassFormat(USERIMAGEPOST);
var USERCARD = "o-ms-fk"; // User on the hover card
var USERCARDDOT = convertClassFormat(USERCARD);
var USERIMAGECOMMENT = "go wi Wh"; // User associated to comment
var USERIMAGECOMMENTDOT = convertClassFormat(USERIMAGECOMMENT);
var USERIMAGEPAGE = "fa-kz Zxa"; // User on own page
var USERIMAGEPAGEDOT = convertClassFormat(USERIMAGEPAGE);
var USERIMAGESINGLEPOST = "we D0b"; // User on single post
var USERIMAGESINGLEPOSTDOT = convertClassFormat(USERIMAGESINGLEPOST);
var USERIMAGEHOME = "ho ica"; // User on home recs
var USERIMAGEHOMEDOT = convertClassFormat(USERIMAGEHOME);

// Posts
var POST = "Ee BK ge";
var POSTDOT = convertClassFormat(POST);
var REPOST = "ZG Sk";
var REPOSTDOT = convertClassFormat(REPOST);

// Event
var EVENT = "Ee Fgb";
var EVENTDOT = convertClassFormat(EVENT);

// Embed
var EMBED = "q9 yg";
var EMBEDDOT = convertClassFormat(EMBED);
var EMBEDMULTI = "q9 yg Qaa Paa";
var EMBEDMULTIDOT = convertClassFormat(EMBEDMULTI);
var EMBEDDRIVE = "q9 yg vI SS";
var EMBEDDRIVEDOT = convertClassFormat(EMBEDDRIVE);

// Community
var COMMUNITY = "Ee";
var COMMUNITYDOT = convertClassFormat(COMMUNITY);
var COMMUNITYJOINED = 'k9c mke Pic I8c JUKJAb';
var COMMUNITYJOINEDDOT = convertClassFormat(COMMUNITYJOINED);
var COMMUNITYJOINPARENTDOT = '.UYd.oEd';
var COMMUNITYPAGE = 'OEd';
var COMMUNITYPAGEDOT = convertClassFormat(COMMUNITYPAGE);
var COMMUNITYIMAGEHOME = 'lB ica';
var COMMUNITYIMAGEHOMEDOT = convertClassFormat(COMMUNITYIMAGEHOME);
var COMMUNITYPOST = 'GM hf Mj';
var COMMUNITYPOSTDOT = convertClassFormat(COMMUNITYPOST);

// ---------- Non- Draggables ---------- //

// Users
var USERLINKPOST ="ob tv Ub Hf";
var USERLINKPOSTDOT = convertClassFormat(USERLINKPOST);
var USERLINKCOMMENT = "ob tv Ub TD";
var USERLINKCOMMENTDOT = convertClassFormat(USERLINKCOMMENT);
var USERLINKEVENT = "ob tv Ub ita";
//var USERLINKEVENTDOT = convertClassFormat(USERLINKEVENT);
var USERLINKSINGLEPOSTDOT = ".ob.tv.Ub";
var USERLINKCARDDOT = ".Ug";
var LINKHOMEDOT = ".d-s.ob.Xi.d-k-l"; // Used for user & community
var HOMERECPARENTDOT = '.Oh'; // Used for user & community
var USERPAGENAMEDOT = ".rna.KXa.Xia.fn";
var USERCOMMENTPARENTDOT = '.Wi.lg';
var USERPOSTPARENTDOT = '.ys';
var USERIMAGECARDDOT = '.we.aYpOjc';
var USERIMAGELINK = 'ob Jk';
var USERIMAGELINKCARDDOT = '.Jk';
var USERSINGLEPOSTPARENTDOT = '.z0b';
var USERSINGLEPOSTPARENTFORSAVEDOT = '.fa-Neb.aIb';
var USERSINGLEEVENTPARENTFORSAVEDOT = '.Xvb.He';
var USERPAGEPARENTDOT = '.xna.Uza';
var USERPAGEPARENTPINDOT = '.URc.ega.Kab';

var USERABOUTPAGEWRAPPER = '.fa-Neb.drc.gXa';
var USERABOUTTEXT = '.y4';
var USERABOUTCAT = '.wna';
var USERABOUTCOMMONTITLE = '.Cr';

var USEREDUCTIONWRAPPER = '.Ee.vna.Jqc';
var USEREDUCATIONDEGREE = '.UZa';
var DEGREESCHOOL = '.PLa';
var DEGREEINFO = '.ija';

var USERBASICWRAPPER = '.Ee.vna.Hqc';
var BASICTITLES = '.E9a.G9a.Rqc';

var USERCONTACTWRAPPER = '.Ee.vna.VRa';
var CONTACTINFOCONTAINER = 'tr';
var CONTACTTYPE = '.MAa';
var CONTACTVALUE = '.PHb';
var CONTACTEMAIL = '.email';

var USERSTORYWRAPPER = '.Ee.vna.WRa';

var USERWORKWRAPPER = '.Ee.vna.Tqc';

// Posts
var POSTURLDOT = '.o-U-s.FI.Rg'; // Used for date too
var REPOSTURLDOT = '.xAhNqd.qg';
var REPOSTVIEWORIGDOT = '.d-s.u9W0n.ZtGLwd';
var POSTPARENT = 'Yp yt Xa';

// Events
var EVENTBANNERIMG = '.Ym';
var EVENTLINKDOT = '.d-s.ob.pw';
var HANGOUTCHECKDOT = '.P6';
var INEVENTHANGOUTCHECKDOT = '.agb';
var INEVENTWRAPPER = '.CF.he';
var POSTHANGOUTCHECKDOT = '.bU.dU';
var EVENTPARENT = 'Yp yt Xa N8b';
var EVENTPARENTDOT = convertClassFormat(EVENTPARENT);
var INEVENTIMGBANNERDOT ='.Ym';
var EVENTDATEDOT = '.d-s.Fy.Ij';
var HANGOUTIMAGEDOT = '.ar.Mc.pLOfrf.kf.zB.pG';
var EVENTIMAGEDOT = '.Xq';
var POSTHANGIMAGEDOT = '.xE.bc';
var POSTEVENTLINKDOT = '.Bba.jU.lU';

// Embed
var EMBEDPHOTODOT = ".ar.Mc";
var EMBEDMULITPHOTODOT = ".ar.Mc.RE";
var EMBEDVIDEODOT = ".ar.Mc.bc.kf";
var EMBEDURLTITLEDOT = '.d-s.ot-anchor';
var EMBEDLINKDOT = ".d-s.ot-anchor.zg";
var EMBEDALLPHOTOSDOT = '.d-s.ob.HQhzCd';
var EMBEDPHOTOLINKDOT = '.d-s.ob.Ks';
var EMBEDSIDEPHOTODOT = 'ar.Mc.Nt';
var EMBEDURLTITLEPARENTDOT = '.rCauNb';
var EMBEDURLTITLEPARENTDRIVEDOT = '.iT';
var EMBEDDESCDOT = '.f34nqb';
var EMBEDVIDEOURLTITLEDOT = '.kq.ot-anchor';
var EMBEDCOMMUNITY = '.d-s.ob.TW.eW.ob';
// To turn off cursor pointer
var EMBEDPLAYDOT = '.bc.vf';
var EMBEDOVERLAYDOT = '.Rl.RJ';
var EMBEDOVERLAYLINKDOT = '.d-s.ot-anchor.Ks';

// Community
//var COMMUNITYREPOST = 'd-s ob aC5wef';
//var COMMUNITYREPOSTDOT = convertClassFormat(COMMUNITYREPOST);
var COMMUNITYLINKPOST = 'd-s ob Zp';
var COMMUNITYLINKPOSTDOT = convertClassFormat(COMMUNITYLINKPOST);
var COMMUNITYLINKJOINEDDOT = '.d-s.ob.w1d.ATc';
var COMMUNITYIMAGEJOINEDDOT = '.we.photo.z1d';
var COMMUNITYLINKPAGEDOT = '.d-s.ob.U0b.oSb';
var COMMUNITYPAGEURLDOT = '.d-s.ob';
var COMMUNITYRECIMAGEDOT = '.hDc';
var COMMUNITYRECTITLEDOT = '.we.photo.gDc';
var COMMUNITYRECMEMBERSDOT = '.E1d';
var COMMUNITYHOMEMEMBERSDOT = '.Tj6Z6d';
var COMMUNITYJOINEDMEMBERSDOT = '.nZd';
var COMMUNITYPAGEIMAGEDOT = '.we.photo.iFd.V0d';
var COMMUNITYPAGEMEMBERSDOT = '.d-s.ob.Q0d';
var COMMUNITYSIDELINKBASIC = 'd-s ob UCc';
var COMMUNITYSIDELINK = 'd-s ob UCc dke';

// Collections
var COLLECTIONCARD = 'd-s ob rYedS';
var COLLECTIONCARD2 = 'd-s ob fgwINe';

// Decription
var DESCRIPTIONDOT ='.Ct';
var LINKCLASSDOT = '.aaTEdf';
var NORMLINK = 'ot-anchor';
var PROFLINK = 'proflink';
var HASHTAG = 'ot-hashtag';

// Comment
var COMMENTDOT = '.Ik.Wv';

// PostActivity
var SHARECOUNTDOT = '.MM.jI';
var COMMENTCOUNTDOT = '.cr.Rs';
var PLUSCOUNTDOT = '.H3';

// ******************************** //
// **********  Dragging   ********* //
// ******************************** //

//TODO: put USERCARDDOT back in -- out for prototype b/c requires more complex code
//TODO: decide if we want USERIMAGECOMMENTDOT
// Elements to be set draggable
var draggable = [USERIMAGEPOSTDOT, USERIMAGESINGLEPOSTDOT,
    POSTDOT, REPOSTDOT, EVENTDOT, EVENTPARENTDOT, EMBEDDOT, EMBEDMULTIDOT, COMMUNITYDOT, COMMUNITYJOINEDDOT,
    COMMUNITYPAGEDOT, COMMUNITYPOSTDOT, EMBEDDRIVEDOT]; //USERIMAGECOMMENTDOT, USERCARDDOT, USERIMAGEHOMEDOT,COMMUNITYIMAGEHOMEDOT,USERIMAGEPAGEDOT,

// Elements to be set non-draggable
var nonDraggable = [  COMMUNITYPAGEURLDOT, EMBEDVIDEODOT, EMBEDPHOTODOT, EMBEDMULITPHOTODOT, EMBEDURLTITLEDOT, EMBEDLINKDOT,
    EVENTBANNERIMG, EVENTLINKDOT, EMBEDPHOTOLINKDOT, HANGOUTIMAGEDOT, EVENTIMAGEDOT, EMBEDSIDEPHOTODOT,
    REPOSTVIEWORIGDOT, POSTHANGIMAGEDOT, EMBEDOVERLAYDOT, EMBEDOVERLAYLINKDOT, INEVENTIMGBANNERDOT ]; //USERIMAGECARDDOT, USERIMAGELINKCARDDOT,

var nonXers = [COMMUNITYSIDELINK, COLLECTIONCARD, COLLECTIONCARD2, COMMUNITYSIDELINKBASIC, USERIMAGELINK];
var selectables = [EMBEDDESCDOT, DESCRIPTIONDOT];

var mutationUpdates = [POSTPARENT, EVENTPARENT, USERCARD];

// GxBar Class Constants
var USERTYPE = 'User';
var POSTTYPE = 'Post';
var EVENTTYPE = 'Event';
var HANGOUTTYPE = 'Hangout';
var EMBEDTYPE = 'EmbededElement';
var COMMUNITYTYPE = 'Community';
var FAILTYPE = 'Fail';

var types = [USERTYPE, POSTTYPE, EVENTTYPE, HANGOUTTYPE, EMBEDTYPE, COMMUNITYTYPE];

// Set Class to Type Mapping
var classToType = {};
classToType[USERIMAGEPOST] = USERTYPE;
//classToType[USERCARD] = USERTYPE;
//classToType[USERIMAGECOMMENT] = USERTYPE;
classToType[USERIMAGEPAGE] = USERTYPE;
classToType[USERIMAGESINGLEPOST] = USERTYPE;
//classToType[USERIMAGEHOME] = USERTYPE;
classToType[POST] = POSTTYPE;
classToType[REPOST] = POSTTYPE;
classToType[EVENT] = EVENTTYPE;
classToType[EMBED] = EMBEDTYPE;
classToType[EMBEDDRIVE] = EMBEDTYPE;
classToType[EMBEDMULTI] = EMBEDTYPE;
classToType[COMMUNITY] = COMMUNITYTYPE;
classToType[COMMUNITYJOINED] = COMMUNITYTYPE;
classToType[COMMUNITYPAGE] = COMMUNITYTYPE;
//classToType[COMMUNITYIMAGEHOME] = COMMUNITYTYPE;
classToType[COMMUNITYPOST] = COMMUNITYTYPE;
//classToType[COMMUNITYREPOST] = COMMUNITYTYPE;

var typeToImage = {};
typeToImage[USERTYPE] = new Image();
typeToImage[USERTYPE].src = chrome.extension.getURL('../images/person.png');
typeToImage[POSTTYPE] = new Image();
typeToImage[POSTTYPE].src = chrome.extension.getURL('../images/post.png');
typeToImage[EVENTTYPE] = new Image();
typeToImage[EVENTTYPE].src = chrome.extension.getURL('../images/event.png');
typeToImage[HANGOUTTYPE] = new Image();
typeToImage[HANGOUTTYPE].src = chrome.extension.getURL('../images/onair.png');
typeToImage[EMBEDTYPE] = new Image();
typeToImage[EMBEDTYPE].src = chrome.extension.getURL('../images/media.png');
typeToImage[COMMUNITYTYPE] = new Image();
typeToImage[COMMUNITYTYPE].src = chrome.extension.getURL('../images/community.png');

var typeToColor = {};
typeToColor[USERTYPE] = '#8e0f50';
typeToColor[POSTTYPE] = '#3b00ec';
typeToColor[EVENTTYPE] = '#5106b8';
typeToColor[HANGOUTTYPE] = '#f62309';
typeToColor[EMBEDTYPE] = '#2082cb';
typeToColor[COMMUNITYTYPE] = '#259300';

var typeToInner = {};
typeToInner[USERTYPE] = '#f0e2e6';
typeToInner[POSTTYPE] = '#d9f0f3';
typeToInner[EVENTTYPE] = '#e9e1f5';
typeToInner[HANGOUTTYPE] = '#f2efe1';
typeToInner[EMBEDTYPE] = '#d9f0f3';
typeToInner[COMMUNITYTYPE] = '#e7f3de';
// ******************************** //
// **********  Parsing   ********** //
// ******************************** //

// User Arrays & Dictionaries

var findLinkOfUser = [ USERIMAGEPOST, USERCARD, USERIMAGECOMMENT, USERIMAGEPAGE, USERIMAGESINGLEPOST, USERIMAGEHOME ];

var getUserLink = {};
getUserLink[USERIMAGEPOST] = USERLINKPOSTDOT;
getUserLink[USERCARD] = USERLINKCARDDOT;
getUserLink[USERIMAGECOMMENT] = USERLINKCOMMENTDOT;
getUserLink[USERIMAGESINGLEPOST] = USERLINKSINGLEPOSTDOT;
//getUserLink[USERIMAGEHOME] = LINKHOMEDOT;
getUserLink[USERIMAGEPAGE] = USERPAGENAMEDOT; // Special Case -- class only used to find name of user
getUserLink[USERLINKPOST] = USERIMAGEPOSTDOT;
getUserLink[USERLINKCOMMENT] = USERIMAGECOMMENTDOT;

var userParent = {};
userParent[USERIMAGEPOST] = USERPOSTPARENTDOT;
userParent[USERIMAGECOMMENT] = USERCOMMENTPARENTDOT;
//userParent[USERIMAGEHOME] = HOMERECPARENTDOT;
userParent[USERIMAGESINGLEPOST] = USERSINGLEPOSTPARENTDOT;
userParent[USERIMAGEPAGE] = USERPAGEPARENTDOT;

// Community Variables
var communityImages = [ COMMUNITYIMAGEHOME ];
var communityLinks = [ COMMUNITYLINKPOST ];

var communityParentNames = {};
communityParentNames[COMMUNITYIMAGEHOME] = HOMERECPARENTDOT;

var communityFieldToClass = {};
// NOTE: Url is found by Community parent()
communityFieldToClass[COMMUNITY] = new Community({title: COMMUNITYRECIMAGEDOT, image: COMMUNITYRECTITLEDOT, members: COMMUNITYRECMEMBERSDOT});
communityFieldToClass[COMMUNITYIMAGEHOME] = new Community({url: LINKHOMEDOT, title: LINKHOMEDOT, image: COMMUNITYIMAGEHOMEDOT, members: COMMUNITYHOMEMEMBERSDOT});
communityFieldToClass[COMMUNITYJOINED] = new Community({url: COMMUNITYLINKJOINEDDOT, title: COMMUNITYLINKJOINEDDOT, image: COMMUNITYIMAGEJOINEDDOT, members: COMMUNITYJOINEDMEMBERSDOT});
communityFieldToClass[COMMUNITYPAGE] = new Community({url: COMMUNITYPAGEURLDOT, title: COMMUNITYLINKPAGEDOT, image: COMMUNITYPAGEIMAGEDOT, members: COMMUNITYPAGEMEMBERSDOT});
communityFieldToClass[COMMUNITYPOST] = new Community({url: COMMUNITYLINKPOSTDOT, title: COMMUNITYLINKPOSTDOT});